var e=this&&this.__awaiter||function(e,t,a,r){return new(a||(a=Promise))((function(l,i){function n(e){try{u(r.next(e))}catch(e){i(e)}}function s(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?l(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(n,s)}u((r=r.apply(e,t||[])).next())}))},t=this&&this.__generator||function(e,t){var a,r,l,i,n={label:0,sent:function(){if(1&l[0])throw l[1];return l[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(s){return function(u){return function(s){if(a)throw new TypeError("Generator is already executing.");for(;i&&(i=0,s[0]&&(n=0)),n;)try{if(a=1,r&&(l=2&s[0]?r.return:s[0]?r.throw||((l=r.return)&&l.call(r),0):r.next)&&!(l=l.call(r,s[1])).done)return l;switch(r=0,l&&(s=[2&s[0],l.value]),s[0]){case 0:case 1:l=s;break;case 4:return n.label++,{value:s[1],done:!1};case 5:n.label++,r=s[1],s=[0];continue;case 7:s=n.ops.pop(),n.trys.pop();continue;default:if(!(l=n.trys,(l=l.length>0&&l[l.length-1])||6!==s[0]&&2!==s[0])){n=0;continue}if(3===s[0]&&(!l||s[1]>l[0]&&s[1]<l[3])){n.label=s[1];break}if(6===s[0]&&n.label<l[1]){n.label=l[1],l=s;break}if(l&&n.label<l[2]){n.label=l[2],n.ops.push(s);break}l[2]&&n.ops.pop(),n.trys.pop();continue}s=t.call(e,n)}catch(e){s=[6,e],r=0}finally{a=l=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}};Object.defineProperty(exports,"__esModule",{value:!0});var a=require("cheerio"),r=require("@libs/fetch"),l=require("@libs/filterInputs"),i=require("dayjs"),n=require("@libs/defaultCover"),s=require("@libs/novelStatus"),u=function(){function u(){this.id="chireads",this.name="Chireads",this.icon="src/fr/chireads/icon.png",this.site="https://chireads.com",this.version="1.0.2",this.filters={tag:{type:l.FilterTypes.Picker,label:"Tag",value:"all",options:[{label:"Tous",value:"all"},{label:"Arts martiaux",value:"arts-martiaux"},{label:"De faible à fort",value:"de-faible-a-fort"},{label:"Adapté en manhua",value:"adapte-en-manhua"},{label:"Cultivation",value:"cultivation"},{label:"Action",value:"action"},{label:"Aventure",value:"aventure"},{label:"Monstres",value:"monstres"},{label:"Xuanhuan",value:"xuanhuan"},{label:"Fantastique",value:"fantastique"},{label:"Adapté en Animé",value:"adapte-en-anime"},{label:"Alchimie",value:"alchimie"},{label:"Éléments de jeux",value:"elements-de-jeux"},{label:"Calme Protagoniste",value:"calme-protagoniste"},{label:"Protagoniste intelligent",value:"protagoniste-intelligent"},{label:"Polygamie",value:"polygamie"},{label:"Belle femelle Lea",value:"belle-femelle-lea"},{label:"Personnages arrogants",value:"personnages-arrogants"},{label:"Système de niveau",value:"systeme-de-niveau"},{label:"Cheat",value:"cheat"},{label:"Protagoniste génie",value:"protagoniste-genie"},{label:"Comédie",value:"comedie"},{label:"Gamer",value:"gamer"},{label:"Mariage",value:"mariage"},{label:"seeking Protag",value:"seeking-protag"},{label:"Romance précoce",value:"romance-precoce"},{label:"Croissance accélérée",value:"croissance-acceleree"},{label:"Artefacts",value:"artefacts"},{label:"Intelligence artificielle",value:"intelligence-artificielle"},{label:"Mariage arrangé",value:"mariage-arrange"},{label:"Mature",value:"mature"},{label:"Adulte",value:"adulte"},{label:"Administrateur de système",value:"administrateur-de-systeme"},{label:"Beau protagoniste",value:"beau-protagoniste"},{label:"Protagoniste charismatique",value:"protagoniste-charismatique"},{label:"Protagoniste masculin",value:"protagoniste-masculin"},{label:"Démons",value:"demons"},{label:"Reincarnation",value:"reincarnation"},{label:"Académie",value:"academie"},{label:"Cacher les vraies capacités",value:"cacher-les-vraies-capacites"},{label:"Protagoniste surpuissant",value:"protagoniste-surpuissant"},{label:"Joueur",value:"joueur"},{label:"Protagoniste fort dès le départ",value:"protagoniste-fort-des-le-depart"},{label:"Immortels",value:"immortels"},{label:"Cultivation rapide",value:"cultivation-rapide"},{label:"Harem",value:"harem"},{label:"Assasins",value:"assasins"},{label:"De pauvre à riche",value:"de-pauvre-a-riche"},{label:"Système de classement de jeux",value:"systeme-de-classement-de-jeux"},{label:"Capacités spéciales",value:"capacites-speciales"},{label:"Vengeance",value:"vengeance"}]}}}return u.prototype.getCheerio=function(l){return e(this,void 0,void 0,(function(){var e;return t(this,(function(t){switch(t.label){case 0:return[4,(0,r.fetchApi)(l,{headers:{"Accept-Encoding":"deflate"}})];case 1:return[4,t.sent().text()];case 2:return e=t.sent(),[2,(0,a.load)(e)]}}))}))},u.prototype.popularNovels=function(a,r){return e(this,arguments,void 0,(function(e,a){var r,l,i,s,u,o,c,f,v,h,p,d,m,b=this,g=a.filters,x=a.showLatestNovels;return t(this,(function(t){switch(t.label){case 0:if(r=this.site,l="all",x)r+="/category/translatedtales/page/"+e;else if(g&&"string"==typeof g.tag.value&&"all"!==g.tag.value&&(l=g.tag.value),"all"!==l)r+="/tag/"+l+"/page/"+e;else if(e>1)return[2,[]];return[4,this.getCheerio(r)];case 1:if(i=t.sent(),s=[],!x&&"all"===l)return[3,7];o=1,x&&(o=2),c=0,t.label=2;case 2:return c<o?1!==c?[3,4]:[4,this.getCheerio(this.site+"/category/original/page/"+e)]:[3,6];case 3:i=t.sent(),t.label=4;case 4:(f=i(".romans-content li")).length||(f=i("#content li")),f.each((function(e,t){var a=i(t).contents().find("div").first().text().trim(),r=i(t).find("div").first().find("img").attr("src"),l=i(t).find("div").first().find("a").attr("href");l&&(u={name:a,cover:r,path:l.replace(b.site,"")},s.push(u))})),t.label=5;case 5:return c++,[3,2];case 6:return[3,8];case 7:12===(v=i(':contains("Populaire")').last().parent().next().find("li > div")).length?v.each((function(e,t){if(e%2==0)h=i(t).find("img").attr("src");else{if(p=i(t).text().trim(),!(d=i(t).find("a").attr("href")))return;u={name:p,cover:h||n.defaultCover,path:d.replace(b.site,"")},s.push(u)}})):(m=v.find("div.popular-list-img img"),v.find("div.popular-list-name").each((function(e,t){var a=i(t).text().trim(),r=i(m[e]).attr("src"),l=i(t).find("a").attr("href");l&&(u={name:a,cover:r,path:l.replace(b.site,"")},s.push(u))}))),t.label=8;case 8:return[2,s]}}))}))},u.prototype.parseNovel=function(a){return e(this,void 0,void 0,(function(){var e,r,l,u,o,c=this;return t(this,(function(t){switch(t.label){case 0:return e={path:a,name:"Sans titre"},[4,this.getCheerio(this.site+a)];case 1:switch(r=t.sent(),e.name=r(".inform-product-txt").first().text().trim()||r(".inform-title").text().trim(),e.cover=r(".inform-product img").attr("src")||r(".inform-product-img img").attr("src")||n.defaultCover,e.summary=r(".inform-inform-txt").text().trim()||r(".inform-intr-txt").text().trim(),(l=r("div.inform-product-txt > div.inform-intr-col").text().trim()||r("div.inform-inform-data > h6").text().trim()).includes("Auteur : ")?e.author=l.substring(l.indexOf("Auteur : ")+9,l.indexOf("Statut de Parution : ")).trim():l.includes("Fantrad : ")?e.author=l.substring(l.indexOf("Fantrad : ")+10,l.indexOf("Statut de Parution : ")).trim():e.author="Inconnu",l.substring(l.indexOf("Statut de Parution : ")+21).toLowerCase()){case"en pause":e.status=s.NovelStatus.OnHiatus;break;case"complet":e.status=s.NovelStatus.Completed;break;default:e.status=s.NovelStatus.Ongoing}return u=[],(o=r(".chapitre-table a")).length||(r("div.inform-annexe-list").first().remove(),o=r(".inform-annexe-list").find("a")),o.each((function(e,t){var a=r(t).text().trim(),l=r(t).attr("href"),n=(0,i.default)(null==l?void 0:l.substring(l.length-11,l.length-1)).format("DD MMMM YYYY");l&&u.push({name:a,releaseTime:n,path:l.replace(c.site,"")})})),e.chapters=u,[2,e]}}))}))},u.prototype.parseChapter=function(a){return e(this,void 0,void 0,(function(){var e;return t(this,(function(t){switch(t.label){case 0:return[4,this.getCheerio(this.site+a)];case 1:return e=t.sent(),[2,e("#content").html()||""]}}))}))},u.prototype.searchNovels=function(a,r){return e(this,void 0,void 0,(function(){var e,l,i;return t(this,(function(t){switch(t.label){case 0:if(1!==r)return[2,[]];e=[],l=1,i=!1,t.label=1;case 1:return i?[3,3]:[4,this.popularNovels(l,{showLatestNovels:!0,filters:void 0}).then((function(t){0===t.length&&(i=!0),e.push.apply(e,t)}))];case 2:return t.sent(),l++,[3,1];case 3:return[2,e=e.filter((function(e){return e.name.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(a.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,""))}))]}}))}))},u}();exports.default=new u;